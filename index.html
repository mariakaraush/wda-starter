<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Discover your next watch, browse by genre and release date, manage your personal watchlist, and explore detailed movie information including cast and crew credits.">
    <title>Showing Movie Data from an API</title>

    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        .title { text-align: center; margin: 20px 0; font-size: 36px; color: #333; }
        nav { display: flex; gap: 30px; align-items: center; border-bottom: #333 solid 1px; }
        .logo { max-width: 80px; max-height: 80px; padding: 0 20px; background-color: #a4e5d9; object-fit: contain; }
    </style>

    <link rel="preload" href="./css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./css/style.css"></noscript>
    
    <script type="module" src="./js/scripts.js"></script>
    <script type="module" src="js/appData.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <div x-data="appData()" x-init="loadMovieData(); filterMovies(); applyDarkMode();">
    <nav>
        <a href="/index.html"><img class="logo" src="./assets/images/film_logo.png" alt="MovieFinder Logo"></a>
        <a href="/index.html">Home</a>
        <a href="/views/watchlist.html">Manage Watchlist</a>

        <button @click="toggleDarkMode()" class="dark-mode-toggle" :aria-label="darkMode ? 'Switch to light mode' : 'Switch to dark mode'">
            <span x-show="!darkMode">üåô</span>
            <span x-show="darkMode">‚òÄÔ∏è</span>
        </button>
    </nav>

    <header>
        <img class="header-image" src="./assets/images/film_logo_full.png" alt="Film Logo">
    </header>

    <h1 class="title">Popular Films</h1>
    

        <div x-show="toastMessage" 
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform translate-x-full"
            x-transition:enter-end="opacity-100 transform translate-x-0"
            x-transition:leave="transition ease-in duration-300"
            x-transition:leave-start="opacity-100 transform translate-x-0"
            x-transition:leave-end="opacity-0 transform translate-x-full"
            class="toast"
            :class="toastType"
            role="alert"
            aria-live="polite">
        <span x-text="toastMessage"></span>
        <button @click="hideToast()" class="close-toast" aria-label="Close notification">x</button>
    </div>

    <div class="filters">
        <label for="search-input" class="sr-only">Search movies</label>
        <input class="search-input" type="text" placeholder="Search movies..." x-model="searchQuery" @input="filterMovies()" />

        <label for="genre-select" class="sr-only">Filter by genre</label>
        <select id="genre-select" class="search-input" x-model="selectedGenre">
            <option value="">All Genres</option>
            <template x-for="genre in staticGenres" :key="genre">
                <option :value="genre" x-text="genre"></option>
            </template>
        </select>

        <label for="release-date-select" class="sr-only">Filter by release date</label>
        <select id="release-date-select" class="search-input" x-model="selectedReleaseDate">
            <option value="">All Release Dates</option>
            <template x-for="year in staticYears" :key="year">
                <option :value="year" x-text="year"></option>
            </template>
        </select>

        <div class="runtime-filters runtime-inputs">
            <label for="runtime-min" class="sr-only">Minimum runtime in minutes</label>
            <input 
                id="runtime-min" 
                class="search-input runtime-input" 
                type="number" 
                placeholder="Min runtime (mins)" 
                x-model="runtimeMin" 
                min="1" 
                max="300"
            />
            
            <label for="runtime-max" class="sr-only">Maximum runtime in minutes</label>
            <input 
                id="runtime-max" 
                class="search-input runtime-input" 
                type="number" 
                placeholder="Max runtime (mins)" 
                x-model="runtimeMax" 
                min="1" 
                max="300"
            />
             </div>
            <div class="runtime-filters">
                <button class="runtime-buttons" @click="applyFilters()">Filter</button>
                <button class="runtime-buttons" @click="clearRuntimeFilters()">Clear all filters</button>
            </div>
       
    </div>

    <div class="movie-count">
        <div>Movies Found: <span x-text="getCurrentMovieCount()"></span></div>
        <div><a href="./views/watchlist.html" class="watchlist-link">
            Movies In Watchlist: <span x-text="watchlist.length"></span>
        </a></div>
    </div>


    <template x-for="movie in movies" :key="movie.id">
        <div class="movie-card">
            <img class="movie-poster" :src="getMoviePoster(movie)" :alt="`Movie poster for ${getMovieTitle(movie)}`" />
            <div class="movie-details">
                <div x-text="getMovieTitle(movie)"></div>
                <div x-show="getMovieOverview(movie)">Overview: <span x-text="getMovieOverview(movie)"></span></div>
                <div>Release Date: <span x-text="getMovieYear(movie)"></span></div>
                <div x-show="getMovieGenres(movie)">Genres: <span x-text="getMovieGenres(movie)"></span></div>
                <div class="movie-buttons">
                    <button @click="getMovieDetailsAndCredits(movie)" :aria-label="`View details for ${getMovieTitle(movie)}`">More Details</button>
                    <button 
                        @click="addToWatchlist(movie.id)" 
                        :aria-label="`Add ${getMovieTitle(movie)} to watchlist`"
                        :class="{ 'in-watchlist': isMovieInWatchlistSync(movie) }"
                        x-text="isMovieInWatchlistSync(movie) ? 'Added to Watchlist' : 'Add to Watchlist'">  
                    </button>
                </div>
            </div>
        </div>
    </template>

    <div x-show="showSlide" x-transition class="slide-panel" @click.away="closeSlide()" @keydown.escape="closeSlide()" tabindex="0" role="dialog" aria-modal="true" aria-labelledby="movie-title">
        <div class="slide-content">
            <button @click="closeSlide()" class="close-btn" aria-label="Close movie details panel">√ó</button>
            <template x-if="selectedMovie">
                <div>
                    <img :src="getMoviePoster(selectedMovie)" :alt="`Movie poster for ${getMovieTitle(selectedMovie)}`" class="slide-poster" />
                    <h2 id="movie-title" x-text="getMovieTitle(selectedMovie)"></h2>
                    <p><strong>Overview:</strong> <span x-text="getMovieOverview(selectedMovie)"></span></p>
                    <p><strong>Release Date:</strong> <span x-text="getMovieYear(selectedMovie)"></span></p>
                    <p><strong>Genres:</strong> <span x-text="getMovieGenres(selectedMovie)"></span></p>
                    <p><strong>Runtime:</strong> <span x-text="getRuntime(selectedMovie) + ' mins'"></span></p>
                    <p><strong>Credits:</strong></p>
                    <div x-show="credits">
                        <template x-for="credit in credits">
                            <div class="cast-member">
                                <img class="cast-image" :src="`https://image.tmdb.org/t/p/w500${credit.profile_path}`" :alt="`Photo of ${credit.name}`">
                                <div class="cast-info">
                                    <p><strong>Name:</strong> <span x-text="credit.name"></span></p>
                                    <p><strong>Character:</strong> <span x-text="credit.character"></span></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>
    </div>
</body>
<footer>
    <p>&copy; 2024 MovieFinder. All rights reserved.</p>
</footer>
</html>